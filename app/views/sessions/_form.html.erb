<%# This is a clearance view, which I've copied here so I can add Google sign in. %>

<%= content_for :head do %>
  <meta name="google-signin-scope" content="profile email">
  <meta name="google-signin-client_id" content="<%= ENV["GOOGLE_OAUTH_CLIENT_ID"] %>">
  <script src="https://apis.google.com/js/platform.js" async defer></script>
<% end %>

<div class="g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
<%= form_for :google_session, url: google_session_path, authenticity_token: true, html: { id: "google_form" } do |form| %>
  <%= form.hidden_field "email", data: { field: "email" } %>
  <%= form.hidden_field "google_user_id", data: { field: "google_user_id" } %>
<% end %>
<script>
  // TODO: This is annoying because it submits automatically on page render. Make the user click it first!
  //       Although, the auto-submit would be useful to determine whether they're already logged in first?
  function onSignIn(googleUser) {
    // Useful data for your client-side scripts:
    var profile = googleUser.getBasicProfile();
    console.log("ID: " + profile.getId()); // Don't send this directly to your server!
    console.log('Full Name: ' + profile.getName());
    console.log('Given Name: ' + profile.getGivenName());
    console.log('Family Name: ' + profile.getFamilyName());
    console.log("Image URL: " + profile.getImageUrl());
    console.log("Email: " + profile.getEmail());

    // The ID token you need to pass to your backend:
    var id_token = googleUser.getAuthResponse().id_token;
    console.log("ID Token: " + id_token);

    var loginForm = $('#google_form');
    loginForm.find("[data-field=email]").val(profile.getEmail());
    loginForm.find("[data-field=google_user_id]").val(id_token);
    loginForm.submit();
  };
</script>

<%= form_for :session, url: session_path do |form| %>

  <div class="text-field">
    <%= form.label :email %>
    <%= form.text_field :email, type: 'email' %>
  </div>

  <div class="password-field">
    <%= form.label :password %>
    <%= form.password_field :password %>
  </div>

  <div class="submit-field">
    <%= form.submit %>
  </div>

  <div class="other-links">
    <% if Clearance.configuration.allow_sign_up? %>
      <%= link_to t(".sign_up"), sign_up_path %>
    <% end %>
    <%= link_to t(".forgot_password"), new_password_path %>
  </div>
<% end %>
